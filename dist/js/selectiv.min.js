(function(){var e;e=function(){function e(e,t,i){this.text=e,this.value=t,null==i&&(i={}),this.isNew=!!i.isNew,this.isPreview=!!i.isPreview}return e}(),Vue.component("selectiv",{template:'<div class="selectiv-component" @mousedown.prevent="toggleAutocomplete">\n  <select multiple v-show="false" v-if="!useStringInput" :name="name" v-model="currSelectedValues">\n    <option v-for="optionItem in selectedOptions" :value="optionItem.value">{{ optionItem.text }}</option>\n  </select>\n  <input type="hidden" v-if="useStringInput" :name="name" :value="delimitedValue">\n  <template v-if="isMultiple">\n    <ul class="selected-options">\n      <template v-for="selectedOption in selectedOptionsWithInput">\n        <li class="option-input" v-if="selectedOption.isInput">\n          <input type="text" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"\n            v-model.trim="inputValue"\n            @keydown="keydown"\n            v-focus="isFocused" @focus="isFocused=true" @blur="isFocused=false"\n            :size="inputSize"\n            :placeholder="inputPlaceholder"\n            :style="inputStyles">\n        </li><li class="option" v-else>\n          <slot name="selectedOption" :text="selectedOption.text" :value="selectedOption.value">\n            <span class="option-text" v-html="selectedOption.text"></span>\n          </slot>\n          <a class="option-close" v-if="hasRemoveButton" @click="removeSelectedOption(selectedOption)" @mousedown.stop.prevent></a>\n        </li>\n      </template>\n    </ul>\n  </template>\n  <template v-else>\n    <span class="single-text" v-html="singleText" :class="{ placeholder: !isSingleValueSet }"></span>\n    <span class="single-clear" v-if="allowClear" @click="removeSelectedOption(selectedSingleOption)" @mousedown.stop.prevent>&times;</span>\n    <span class="single-arrow" :class="{ \'arrow-up\': isAutocompleteVisible, \'arrow-down\': !isAutocompleteVisible }"></span>\n  </template>\n  <div class="autocomplete-wrapper autocomplete-below"\n    v-if="isAutocompleteVisible"\n    v-set-top-position="isAutocompleteVisible">\n    <span v-if="!isMultiple" class="single-input-wrapper">\n      <input type="text" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"\n        v-model.trim="inputValue"\n        @keydown="keydown"\n        @mousedown.stop\n        v-focus="isFocused" @focus="isFocused=true" @blur="isFocused=false">\n    </span>\n    <slot name="noResults" :search-text="inputValue" v-if="isNoResultsVisible">\n      <span class="no-results">No results</span>\n    </slot>\n    <ul class="autocomplete">\n      <li v-for="(option, index) in autocompleteOptions"\n        :class="{ selected: isSelected(option), \'new-option-preview\': option.isPreview, highlighted: autocompleteIndex === index }"\n        v-scroll-into-view="index === autocompleteIndex"\n        @mouseup="selectAutocompleteOption(index)"\n        @mouseover="autocompleteIndex = index"\n        @mousedown.stop.prevent>\n        <slot name="option" :text="option.text" :value="option.value" :text-marked="formatOptionText(option)" :value-marked="markOptionField(option.value)">\n          <span v-html="formatOptionText(option)"></span>\n        </slot>\n      </li>\n    </ul>\n  </div>\n</div>',props:{options:{type:Array,default:function(){return[]}},optionsText:{type:String,default:"text"},optionsValue:{type:String,default:"value"},isMultiple:{type:Boolean,default:!1},placeholder:{type:String,default:""},value:[Array,String,Number],name:{default:"options"},allowNew:{type:Boolean,default:!1},hasAutocomplete:{type:Boolean,default:!0},restoreOnBackspace:{type:Boolean,default:!1},hasRemoveButton:{type:Boolean,default:!0},newValueFormat:{type:String,validator:function(e){return e.indexOf("%value%")>-1}},valueDelimiter:{type:String,default:null},searchValue:{type:Boolean,default:!1}},directives:{"set-top-position":{inserted:function(e,t){var i,n,s,l;return t.value?(n=e.getBoundingClientRect(),n.top+n.height<window.innerHeight||window.innerHeight-n.top>n.top?e.className=e.className.replace("autocomplete-above","autocomplete-below"):(l=e.parentNode,s=getComputedStyle(l),i=parseFloat(s.getPropertyValue("border-top-width"))+parseFloat(s.getPropertyValue("border-bottom-width")),e.style.bottom=l.getBoundingClientRect().height-i+"px",e.className=e.className.replace("autocomplete-below","autocomplete-above"))):e.style.bottom=null}},"scroll-into-view":{update:function(e,t){var i,n,s,l,o,u,a;if(t.value)return s=[e.parentNode,e.getBoundingClientRect()],u=s[0],n=s[1],l=[e.offsetTop+n.height,u.getBoundingClientRect()],i=l[0],a=l[1],o=a.height+u.scrollTop,e.offsetTop<u.scrollTop?u.scrollTop=e.offsetTop:i>o?u.scrollTop+=i-o:void 0}},focus:{inserted:function(e,t){return t.value?e.focus():e.blur()},update:function(e,t){return t.value?e.focus():e.blur()}}},data:function(){return{currSelectedValues:null,userAddedOptions:[],isFocused:!1,isAutocompleteVisible:!1,inputValue:"",autocompleteIndex:0,inputIndex:0}},created:function(){return this.currSelectedValues=this.valueAsArray(),this.validateSelectedValues(),this.fireChange()},computed:{optionItems:function(){var t;return t=this.options.length>0?this.options:this.valueAsArray(),t.concat(this.userAddedOptions).map(function(t){return function(i){var n,s,l;return n="object"==typeof i?[i[t.optionsText],i[t.optionsValue]]:[i,i],s=n[0],l=n[1],new e(s,l,{isNew:i.isNew,isPreview:i.isPreview})}}(this))},delimitedValue:function(){return this.currSelectedValues.join(this.valueDelimiter)},selectedOptions:function(){return this.currSelectedValues.map(function(e){return function(t){return e.findOptionBy("value",t)}}(this))},selectedOptionsWithInput:function(){return this.selectedOptions.slice(0,this.inputIndex).concat({isInput:!0}).concat(this.selectedOptions.slice(this.inputIndex))},useStringInput:function(){return Boolean(this.valueDelimiter||0===this.currSelectedValues.length)},selectedSingleOption:function(){return this.selectedOptions[0]},singleText:function(){var e;return(null!=(e=this.selectedSingleOption)?e.text:void 0)||this.placeholder},singleValue:function(){var e;return null!=(e=this.selectedSingleOption)?e.value:void 0},isSingleValueSet:function(){return Boolean(this.singleValue||""===this.singleValue)},allowClear:function(){return Boolean(this.placeholder&&this.isSingleValueSet)},autocompleteOptions:function(){var t,i,n,s,l;return i=[this.inputValue,new RegExp(this.inputValue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i")],l=i[0],n=i[1],t=this.optionItems.filter(function(e){return function(t){return t.text.search(n)>-1||e.searchValue&&String(t.value).search(n)>-1}}(this)),""!==l&&this.allowNew&&(s=t.filter(function(e){return e.text===l})[0],s||(s=new e(l,this.makeNewValue(l),{isNew:!0,isPreview:!0}),t.unshift(s))),t},isNoResultsVisible:function(){return!this.allowNew&&0===this.autocompleteOptions.length},inputSize:function(){var e;return e=""===this.inputValue?this.inputPlaceholder.length:this.inputValue.length,Math.max(e,1)+1},inputStyles:function(){if(this.inputIndex<this.currSelectedValues.length&&""===this.inputValue)return{width:"4px"}},inputPlaceholder:function(){return 0===this.currSelectedValues.length?this.placeholder:""},computedValue:function(){return this.isMultiple?this.useStringInput?this.delimitedValue:this.currSelectedValues:this.singleValue}},methods:{keydown:function(e){var t,i,n,s,l;if(t={left:37,up:38,right:39,down:40,enter:13,tab:9,backspace:8,esc:27,comma:188},l=[!1,e.keyCode?e.keyCode:e.which],i=l[0],n=l[1],n===t.esc?this.hideAutocomplete():n!==t.left&&n!==t.right||""!==this.inputValue?n!==t.down||this.isAutocompleteVisible?n!==t.up&&n!==t.down||!this.isAutocompleteVisible?n===t.enter&&this.isAutocompleteVisible?this.selectAutocompleteOption():n===t.tab||n===t.enter||n===t.comma&&!e.shiftKey?i=!this.addFromInput()&&n!==t.enter&&n!==t.comma:n===t.backspace&&this.isMultiple&&""===this.inputValue&&this.currSelectedValues.length>0?(s=this.findOptionBy("value",this.currSelectedValues[this.inputIndex-1]),this.unselectOption(s)&&this.restoreOnBackspace&&(this.inputValue=s.text)):i=!0:this.incAutocompleteIndex(n===t.up?-1:1):this.showAutocomplete():this.incInputIndex(n===t.left?-1:1),!i)return e.preventDefault()},validateSelectedValues:function(){var e,t,i,n;for(i=this.currSelectedValues,e=t=i.length-1;t>=0;e=t+=-1)n=i[e],this.findOptionBy("value",this.currSelectedValues[e])||this.currSelectedValues.splice(e,1);return this.isMultiple||(!this.placeholder&&0===this.currSelectedValues.length&&this.optionItems[0]?this.currSelectedValues.push(this.optionItems[0].value):this.currSelectedValues.length>1&&this.currSelectedValues.splice(1)),this.inputIndex=this.currSelectedValues.length},findOptionBy:function(e,t){return this.optionItems.filter(function(i){return i[e]===t})[0]},makeNewValue:function(e){return this.newValueFormat?this.newValueFormat.replace("%value%",e):e},isSelected:function(e){return this.currSelectedValues.indexOf(e.value)>-1},removeSelectedOption:function(e){return this.unselectOption(e),this.showAutocomplete(),this.isFocused=!0},showAutocomplete:function(){var e,t,i;if(this.hasAutocomplete)return t=this.autocompleteOptions,t.length>0&&(e=t[0].isPreview&&t.length>1?(i=t.filter(function(e){return function(t){return!t.isPreview&&!e.isSelected(t)}}(this))[0],i?this.findIndexByValue(t,i.value):void 0):void 0,this.autocompleteIndex=e||0),this.isAutocompleteVisible=t.length>0||this.isNoResultsVisible},hideAutocomplete:function(){return this.isAutocompleteVisible=!1},toggleAutocomplete:function(){return this.isAutocompleteVisible?(this.hideAutocomplete(),this.isMultiple?void 0:this.isFocused=!1):(this.showAutocomplete(),this.isFocused=!0)},selectAutocompleteOption:function(e){var t;return t=this.autocompleteOptions[e||this.autocompleteIndex],!(!t||t.isPreview&&!this.allowNew)&&(t.isPreview=!1,this.selectOption(t))},addFromInput:function(){var t,i;return i=this.inputValue,""!==i&&(t=this.findOptionBy("text",i)||new e(i,this.makeNewValue(i),{isNew:!0}),this.selectOption(t))},selectOption:function(e){return!(this.isSelected(e)||e.isNew&&!this.allowNew)&&(this.isMultiple||this.unselectOption(this.selectedSingleOption),e.isNew&&this.userAddedOptions.push(e),this.currSelectedValues.splice(this.inputIndex,0,e.value),this.inputValue="",this.incInputIndex(),this.fireChange(),Vue.nextTick(function(e){return function(){return e.hideAutocomplete()}}(this)),!0)},unselectOption:function(e){var t;return!!e&&(t=this.currSelectedValues.indexOf(e.value),this.currSelectedValues.splice(t,1),this.inputIndex>t&&this.incInputIndex(-1),e.isNew&&this.userAddedOptions.splice(this.findIndexByValue(this.userAddedOptions,e.value),1),this.fireChange(),!0)},markOptionField:function(e){var t,i,n;return this.inputValue?(n=new RegExp("("+this.inputValue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+")","i"),i=function(){var i,s,l,o;for(l=String(e).split(n),o=[],i=0,s=l.length;i<s;i++)t=l[i],n.test(t)?o.push('<mark class="search-match">'+t+"</mark>"):o.push(t);return o}(),i.join("")):e},formatOptionText:function(e){return e.isPreview?e.text:this.markOptionField(e.text)},findIndexByValue:function(e,t){return e.map(function(e){return e.value}).indexOf(t)},incInputIndex:function(e){var t;return null==e&&(e=1),t=Math.max(this.inputIndex+e,0),this.inputIndex=Math.min(t,this.currSelectedValues.length)},incAutocompleteIndex:function(e){var t,i,n;return null==e&&(e=1),i=[this.autocompleteIndex+e,this.autocompleteOptions.length-1],t=i[0],n=i[1],this.autocompleteIndex=t>n?0:t<=-1?n:t},fireChange:function(){return this.$emit("change",this.computedValue)},valueAsArray:function(){return"string"==typeof this.value&&this.valueDelimiter?this.value.split(this.valueDelimiter):[].concat(this.value||[])}},watch:{inputValue:"showAutocomplete",options:"validateSelectedValues",isFocused:function(e){if(!e)return this.inputValue="",this.inputIndex=this.currSelectedValues.length,Vue.nextTick(function(e){return function(){return e.hideAutocomplete()}}(this))}}})}).call(this);