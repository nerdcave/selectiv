"use strict";function OptionItem(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.text=e,this.value=t,this.isNew=!!i.isNew,this.isPreview=!!i.isPreview}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SelectivComponent={template:'\n    <div class="selectiv-component" @mousedown.prevent="toggleAutocomplete">\n      <select multiple v-show="false" v-if="!useStringInput" :name="name" v-model="currSelectedValues">\n        <option v-for="optionItem in selectedOptions" :value="optionItem.value">{{ optionItem.text }}</option>\n      </select>\n      <input type="hidden" v-if="useStringInput" :name="name" :value="delimitedValue">\n      <template v-if="isMultiple">\n        <ul class="selected-options">\n          <template v-for="selectedOption in selectedOptionsWithInput">\n            <li class="option-input" v-if="selectedOption.isInput">\n              <input type="text" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"\n                v-model.trim="inputValue"\n                @keydown="keydown"\n                v-focus="isFocused" @focus="isFocused=true" @blur="isFocused=false"\n                :size="inputSize"\n                :placeholder="inputPlaceholder"\n                :style="inputStyles">\n            </li><li class="option" v-else>\n              <slot name="selectedOption" :text="selectedOption.text" :value="selectedOption.value">\n                <span class="option-text" v-html="selectedOption.text"></span>\n              </slot>\n              <a class="option-close" v-if="hasRemoveButton" @click="removeSelectedOption(selectedOption)" @mousedown.stop.prevent></a>\n            </li>\n          </template>\n        </ul>\n      </template>\n      <template v-else>\n        <span class="single-text" v-html="singleText" :class="{ placeholder: !isSingleValueSet }"></span>\n        <span class="single-clear" v-if="allowClear" @click="removeSelectedOption(selectedSingleOption)" @mousedown.stop.prevent>&times;</span>\n        <span class="single-arrow" :class="{ \'arrow-up\': isAutocompleteVisible, \'arrow-down\': !isAutocompleteVisible }"></span>\n      </template>\n      <div class="autocomplete-wrapper autocomplete-below"\n        v-if="isAutocompleteVisible"\n        v-set-top-position="isAutocompleteVisible">\n        <span v-if="!isMultiple" class="single-input-wrapper">\n          <input type="text" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"\n            v-model.trim="inputValue"\n            @keydown="keydown"\n            @mousedown.stop\n            v-focus="isFocused" @focus="isFocused=true" @blur="isFocused=false">\n        </span>\n        <slot name="noResults" :search-text="inputValue" v-if="isNoResultsVisible">\n          <span class="no-results">No results</span>\n        </slot>\n        <ul class="autocomplete">\n          <li v-for="(option, index) in autocompleteOptions"\n            :class="{ selected: isSelected(option), \'new-option-preview\': option.isPreview, highlighted: autocompleteIndex === index }"\n            v-scroll-into-view="index === autocompleteIndex"\n            @mouseup="selectAutocompleteOption(index)"\n            @mouseover="autocompleteIndex = index"\n            @mousedown.stop.prevent>\n            <slot name="option" :text="option.text" :value="option.value" :text-marked="formatOptionText(option)" :value-marked="markOptionField(option.value)">\n              <span v-html="formatOptionText(option)"></span>\n            </slot>\n          </li>\n        </ul>\n      </div>\n    </div>\n  ',props:{options:{type:Array,default:function(){return[]}},optionText:{type:String,default:"text"},optionValue:{type:String,default:"value"},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:""},value:[Array,String,Number],name:{default:"options"},allowNew:{type:Boolean,default:!1},hasAutocomplete:{type:Boolean,default:!0},restoreOnBackspace:{type:Boolean,default:!1},hasRemoveButton:{type:Boolean,default:!0},newValueFormat:{type:String,validator:function(e){return e.indexOf("%value%")>-1}},valueDelimiter:{type:String,default:null},searchValue:{type:Boolean,default:!1}},directives:{"set-top-position":{inserted:function(e,t){if(t.value){var i=e.getBoundingClientRect();if(i.top+i.height<window.innerHeight||window.innerHeight-i.top>i.top)e.className=e.className.replace("autocomplete-above","autocomplete-below");else{var n=e.parentNode,l=getComputedStyle(n),o=parseFloat(l.getPropertyValue("border-top-width"))+parseFloat(l.getPropertyValue("border-bottom-width"));e.style.bottom=n.getBoundingClientRect().height-o+"px",e.className=e.className.replace("autocomplete-below","autocomplete-above")}}else e.style.bottom=null}},"scroll-into-view":{update:function(e,t){if(t.value){var i=e.parentNode,n=e.getBoundingClientRect(),l=e.offsetTop+n.height,o=i.getBoundingClientRect(),s=o.height+i.scrollTop;e.offsetTop<i.scrollTop?i.scrollTop=e.offsetTop:l>s&&(i.scrollTop+=l-s)}}},focus:{inserted:function(e,t){t.value?e.focus():e.blur()},update:function(e,t){t.value?e.focus():e.blur()}}},data:function(){return{currSelectedValues:null,userAddedOptions:[],isFocused:!1,isAutocompleteVisible:!1,inputValue:"",autocompleteIndex:0,inputIndex:0}},created:function(){this.currSelectedValues=this.valueAsArray(),this.validateSelectedValues(),this.fireChange()},computed:{optionItems:function(){var e=this;return(this.options.length>0?this.options:this.valueAsArray()).concat(this.userAddedOptions).map(function(t){var i="object"===(void 0===t?"undefined":_typeof(t))?t[e.optionText]:t;return new OptionItem(i,"object"===(void 0===t?"undefined":_typeof(t))?t[e.optionValue]:i,{isNew:t.isNew,isPreview:t.isPreview})})},isMultiple:function(){return this.multiple},delimitedValue:function(){return this.currSelectedValues.join(this.valueDelimiter)},selectedOptions:function(){var e=this;return this.currSelectedValues.map(function(t){return e.findOptionBy("value",t)})},selectedOptionsWithInput:function(){return this.selectedOptions.slice(0,this.inputIndex).concat({isInput:!0}).concat(this.selectedOptions.slice(this.inputIndex))},useStringInput:function(){return Boolean(this.valueDelimiter||0===this.currSelectedValues.length)},selectedSingleOption:function(){return this.selectedOptions[0]},singleText:function(){return(null!=this.selectedSingleOption?this.selectedSingleOption.text:void 0)||this.placeholder},singleValue:function(){return null!=this.selectedSingleOption?this.selectedSingleOption.value:void 0},isSingleValueSet:function(){return Boolean(this.singleValue||""===this.singleValue)},allowClear:function(){return Boolean(this.placeholder&&this.isSingleValueSet)},autocompleteOptions:function(){var e=this,t=this.inputValue,i=new RegExp(this.inputValue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),n=this.optionItems.filter(function(t){return t.text.search(i)>-1||e.searchValue&&String(t.value).search(i)>-1});if(""!==t&&this.allowNew){var l=n.filter(function(e){return e.text===t})[0];l||(l=new OptionItem(t,this.makeNewValue(t),{isNew:!0,isPreview:!0}),n.unshift(l))}return n},isNoResultsVisible:function(){return!this.allowNew&&0===this.autocompleteOptions.length},inputSize:function(){var e=""===this.inputValue?this.inputPlaceholder.length:this.inputValue.length;return Math.max(e,1)+1},inputStyles:function(){if(this.inputIndex<this.currSelectedValues.length&&""===this.inputValue)return{width:"4px"}},inputPlaceholder:function(){return 0===this.currSelectedValues.length?this.placeholder:""},computedValue:function(){return this.isMultiple?this.useStringInput?this.delimitedValue:this.currSelectedValues:this.singleValue}},KEYS:{left:37,up:38,right:39,down:40,enter:13,tab:9,backspace:8,esc:27,comma:188},methods:{keydown:function(e){var t=SelectivComponent.KEYS,i=!1,n=e.keyCode?e.keyCode:e.which;if(n===t.esc)this.hideAutocomplete();else if(n!==t.left&&n!==t.right||""!==this.inputValue)if(n!==t.down||this.isAutocompleteVisible)if(n!==t.up&&n!==t.down||!this.isAutocompleteVisible)if(n===t.enter&&this.isAutocompleteVisible)this.selectAutocompleteOption();else if(n===t.tab||n===t.enter||n===t.comma&&!e.shiftKey)i=!this.addFromInput()&&!(n===t.enter||n===t.comma);else if(n===t.backspace&&this.isMultiple&&""===this.inputValue&&this.currSelectedValues.length>0){var l=this.findOptionBy("value",this.currSelectedValues[this.inputIndex-1]);this.unselectOption(l)&&this.restoreOnBackspace&&(this.inputValue=l.text)}else i=!0;else this.incAutocompleteIndex(n===t.up?-1:1);else this.showAutocomplete();else this.incInputIndex(n===t.left?-1:1);i||e.preventDefault()},validateSelectedValues:function(){for(var e=this.currSelectedValues.length-1;e>=0;e--){var t=this.currSelectedValues[e];this.findOptionBy("value",t)||this.currSelectedValues.splice(e,1)}this.isMultiple||(!this.placeholder&&0===this.currSelectedValues.length&&this.optionItems[0]?this.currSelectedValues.push(this.optionItems[0].value):this.currSelectedValues.length>1&&this.currSelectedValues.splice(1)),this.inputIndex=this.currSelectedValues.length},findOptionBy:function(e,t){return this.optionItems.filter(function(i){return i[e]===t})[0]},makeNewValue:function(e){return this.newValueFormat?this.newValueFormat.replace("%value%",e):e},isSelected:function(e){return this.currSelectedValues.indexOf(e.value)>-1},removeSelectedOption:function(e){this.unselectOption(e),this.showAutocomplete(),this.isFocused=!0},showAutocomplete:function(){var e=this;if(this.hasAutocomplete){var t=this.autocompleteOptions;if(t.length>0){var i=0;if(t[0].isPreview&&t.length>1){var n=t.filter(function(t){return!t.isPreview&&!e.isSelected(t)})[0];n&&(i=this.findIndexByValue(t,n.value))}this.autocompleteIndex=i}this.isAutocompleteVisible=t.length>0||this.isNoResultsVisible}},hideAutocomplete:function(){this.isAutocompleteVisible=!1},toggleAutocomplete:function(){this.isAutocompleteVisible?(this.hideAutocomplete(),this.isMultiple||(this.isFocused=!1)):(this.showAutocomplete(),this.isFocused=!0)},selectAutocompleteOption:function(e){var t=this.autocompleteOptions[e||this.autocompleteIndex];return!(!t||t.isPreview&&!this.allowNew)&&(t.isPreview=!1,this.selectOption(t))},addFromInput:function(){var e=this.inputValue;if(""===e)return!1;var t=this.findOptionBy("text",e)||new OptionItem(e,this.makeNewValue(e),{isNew:!0});return this.selectOption(t)},selectOption:function(e){var t=this;return!(this.isSelected(e)||e.isNew&&!this.allowNew)&&(this.isMultiple||this.unselectOption(this.selectedSingleOption),e.isNew&&this.userAddedOptions.push(e),this.currSelectedValues.splice(this.inputIndex,0,e.value),this.inputValue="",this.incInputIndex(),this.fireChange(),Vue.nextTick(function(){return t.hideAutocomplete()}),!0)},unselectOption:function(e){if(!e)return!1;var t=this.currSelectedValues.indexOf(e.value);return this.currSelectedValues.splice(t,1),this.inputIndex>t&&this.incInputIndex(-1),e.isNew&&this.userAddedOptions.splice(this.findIndexByValue(this.userAddedOptions,e.value),1),this.fireChange(),!0},markOptionField:function(e){if(!this.inputValue)return e;var t=new RegExp("("+this.inputValue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+")","i");return String(e).split(t).map(function(e){return t.test(e)?'<mark class="search-match">'+e+"</mark>":e}).join("")},formatOptionText:function(e){return e.isPreview?e.text:this.markOptionField(e.text)},findIndexByValue:function(e,t){return e.map(function(e){return e.value}).indexOf(t)},incInputIndex:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Math.max(this.inputIndex+e,0);this.inputIndex=Math.min(t,this.currSelectedValues.length)},incAutocompleteIndex:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.autocompleteIndex+e,i=this.autocompleteOptions.length-1;this.autocompleteIndex=t>i?0:t<=-1?i:t},fireChange:function(){this.$emit("change",this.computedValue)},valueAsArray:function(){return"string"==typeof this.value&&this.valueDelimiter?this.value.split(this.valueDelimiter):[].concat(this.value||[])}},watch:{inputValue:"showAutocomplete",options:"validateSelectedValues",isFocused:function(e){var t=this;e||(this.inputValue="",this.inputIndex=this.currSelectedValues.length,Vue.nextTick(function(){return t.hideAutocomplete()}))}}};Vue.component("selectiv",SelectivComponent);